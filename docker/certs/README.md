# Serles ACME Server - Certificates Directory

This directory contains certificates used by Serles ACME Server.

## Certificate Types

### 1. EJBCA Client Certificate (generated by bootstrap)

- `client01-privpub.pem`: Client certificate for EJBCA SOAP API authentication
- `client01.pwd`: Password file for P12 keystore (temporary)

### 2. TLS Server Certificate (optional, for HTTPS)

- `server.crt`: Self-signed server certificate
- `server.key`: Server private key

## TLS Setup (Optional)

> **Note**: TLS is **OPTIONAL** and disabled by default.

Enable TLS for:

- Local development with example ACME clients
- End-to-end encryption scenarios
- Testing HTTPS configurations

For Kubernetes/production with ingress TLS termination, keep TLS disabled.

### Generate Self-Signed Certificate

```bash
./docker/generate-tls-cert.sh localhost
```

### Enable TLS in Docker Compose

**Method 1 - Using override file (recommended):**

```bash
docker-compose -f docker-compose.yaml -f docker-compose.tls.yaml up -d
```

**Method 2 - Environment variable:**

Uncomment `TLS_ENABLED` in [docker-compose.yaml](../docker-compose.yaml) and set to `"true"`

**Method 3 - Set COMPOSE_FILE:**

```bash
export COMPOSE_FILE=docker-compose.yaml:docker-compose.tls.yaml
docker-compose up -d
```

### Test HTTPS

```bash
curl -k https://localhost:8443/directory
```

## Custom Certificates

For production with real certificates:

1. Place your certificate and key in this directory
2. Update [docker-compose.yaml](../docker-compose.yaml):

```yaml
TLS_ENABLED: "true"
TLS_CERT_FILE: "/etc/serles/tls/your-cert.crt"
TLS_KEY_FILE: "/etc/serles/tls/your-cert.key"
```

## Kubernetes Deployment

### For k8s with ingress TLS termination:

- Keep `TLS_ENABLED: "false"` (default)
- Let ingress handle HTTPS
- Serles serves HTTP internally

### For k8s with end-to-end encryption:

- Set `TLS_ENABLED: "true"`
- Mount certificates as secrets
- Configure `TLS_CERT_FILE` and `TLS_KEY_FILE` paths

## Security Notes

⚠️ **Important Security Considerations:**

- Self-signed certificates are for **DEVELOPMENT ONLY**
- Use `--insecure`/`-k` flag with curl/ACME clients for self-signed certs
- All certificate files are gitignored
- Server key has 600 permissions (owner read/write only)
- For production, use certificates from a trusted CA

## File Permissions

| File                   | Permissions                   | Description                         |
| ---------------------- | ----------------------------- | ----------------------------------- |
| `server.key`           | `600` (owner read/write only) | Private key - keep secure           |
| `server.crt`           | `644` (world-readable)        | Public certificate                  |
| `client01-privpub.pem` | `600` (owner read/write only) | Client certificate with private key |
| `client01.pwd`         | `600` (owner read/write only) | Temporary password file             |
